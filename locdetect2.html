<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Map with Nearby Hospitals</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Inline Style for Map Container -->
    <style>
        #map {
            height: 600px; /* Adjust height as needed */
            width: 100%; /* Full width of the page */
        }
    </style>
</head>
<body>
    <h3>Nearby Hospitals Map</h3>
    <p id="status">Fetching your location...</p>
    
    <!-- Map Container -->
    <div id="map"></div>
    
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize the map
        const map = L.map('map').setView([20.5937, 78.9629], 5); // Default to India
        
        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        }).addTo(map);

        // Update the status element
        const statusElement = document.getElementById("status");

        // Function to fetch and add hospital markers
        function fetchHospitals(lat, lon, radius = 5000) { // Default radius is 5000 meters
            const overpassUrl = "https://overpass-api.de/api/interpreter";
            const overpassQuery = `
                [out:json];
                node["amenity"="hospital"](around:${radius},${lat},${lon});
                out body;
            `;

            fetch(${overpassUrl}?data=${encodeURIComponent(overpassQuery)})
                .then(response => response.json())
                .then(data => {
                    if (data.elements.length === 0) {
                        alert("No hospitals found nearby!");
                        return;
                    }

                    // Add markers for hospitals
                    data.elements.forEach(hospital => {
                        if (hospital.lat && hospital.lon) {
                            const name = hospital.tags.name || "Unnamed Hospital";
                            const address = hospital.tags["addr:full"] || "Address not available";
                            const phone = hospital.tags.phone || "Phone not available";

                            const marker = L.marker([hospital.lat, hospital.lon]).addTo(map);
                            marker.bindPopup(`
                                <b>${name}</b><br>
                                Address: ${address}<br>
                                Phone: ${phone}<br>
                                <a href="#" onclick="showDetails('${name}', '${address}', '${phone}')">More Details</a>
                            `);
                        }
                    });

                    map.setView([lat, lon], 13); // Zoom to user's location
                })
                .catch(error => {
                    console.error("Error fetching hospital data:", error);
                    alert("Failed to load nearby hospitals. Please try again later.");
                });
        }

        // Function to handle geolocation success
        function onLocationSuccess(position) {
            const { latitude, longitude } = position.coords;

            // Update map and status
            map.setView([latitude, longitude], 13);
            statusElement.textContent = "Showing hospitals near your location.";

            // Fetch nearby hospitals
            fetchHospitals(latitude, longitude);
        }

        // Function to handle geolocation error
        function onLocationError(error) {
            console.error("Geolocation error:", error.message);
            statusElement.textContent = "Unable to fetch your location. Please check your browser settings.";
        }

        // Function to show detailed information
        function showDetails(name, address, phone) {
            alert(Hospital Details:\n\nName: ${name}\nAddress: ${address}\nPhone: ${phone});
        }

        // Request user's location
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(onLocationSuccess, onLocationError);
        } else {
            statusElement.textContent = "Geolocation is not supported by your browser.";
        }
    </script>
</body>
</html>